<!-- Simple refresh controls script -->
<!-- Updates the "last refresh time" display when htmx swaps content -->

<script>
(function() {
    // Update last refresh time display
    function updateRefreshTime() {
        const el = document.getElementById('last-refresh-time');
        if (el) {
            el.textContent = new Date().toLocaleTimeString('en-US', { hour12: false });
        }
    }

    // Manual refresh button triggers htmx refresh event or page reload
    document.getElementById('manual-refresh')?.addEventListener('click', function() {
        // Find element with htmx polling trigger (not on body)
        const target = document.querySelector('[hx-trigger*="every"]:not(body)');
        if (target && target.getAttribute('hx-trigger').includes('refresh')) {
            // Metrics page: trigger custom refresh event
            htmx.trigger(target, 'refresh');
        } else {
            // Other pages: full page reload for simplicity
            window.location.reload();
        }
    });

    // Update time on page load and after htmx swaps
    updateRefreshTime();
    document.body.addEventListener('htmx:afterSwap', updateRefreshTime);
})();
</script>
